name: NRLC CI
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with: { php-version: '8.2' }
      - name: PHP Syntax Check
        run: |
          php -l $(git ls-files '*.php') || exit 1
      - name: Generate matrices and build
        run: |
          set -e
          if [ -f scripts/generate_matrix.php ]; then
            make matrix
          else
            echo "⚠️  scripts/generate_matrix.php not found, skipping"
          fi
          if [ -f scripts/generate_career_matrix.php ]; then
            make careers
          else
            echo "⚠️  scripts/generate_career_matrix.php not found, skipping"
          fi
          make build
          if [ -f scripts/validate_sitemaps.php ]; then
            make validate
          else
            echo "⚠️  scripts/validate_sitemaps.php not found, skipping"
          fi
      - name: Contracts and smoke tests
        run: |
          make contracts || echo "Contracts check skipped"
          make sitemap-smoke || echo "Sitemap smoke test skipped"
        continue-on-error: true
      - name: Content gate
        run: |
          make content-gate || echo "Content gate skipped"
        continue-on-error: true
      - name: News freshness check
        run: |
          make news-fresh || echo "No fresh news; skipping fail on PRs"
        continue-on-error: true
